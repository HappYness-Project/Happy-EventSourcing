@page "/"
@page "/todos"
@inherits TodoBase
@using HP.Application.DTOs
@using HP.Application.Queries.Todos
@inject MediatR.IMediator _mediator

<h3>Todos</h3>
<div class="text-left bg-blue-100">
    <input class="border-4 w-1/3 rounded m-6 p-6 h-8
               border-blue-300" @bind-value="TodoIdInput"
           @bind-value:event="oninput" placeholder="Search by Todo ID" @onkeyup="@(() => SearchChanged(TodoIdInput))" />
</div>

@if (string.IsNullOrEmpty(TodoIdInput))
{
    <div class="w-100">
        <table class="table table-striped table-bordered">
            <thead>
                <tr>
                    <th>TODO ID</th>
                    <th>User ID</th>
                    <th>Title</th>
                    <th>Options</th>

                </tr>
            </thead>
            <tbody>

                @if (Todos == null)
                {
                    <tr><td><em>Loading...</em></td></tr>
                }

                @foreach (var t in Todos)
                {
                    <tr>
                        <td style="text-underline-position:below; cursor:pointer; color:blue" @onclick="@(() => OnClickViewDetails(t.TodoId))">@t.TodoId</td>
                        <td>@t.UserId</td>
                        <td>@t.TodoTitle</td>
                        <td>
                            <button type="button" class="btn btn-primary" @onclick="@(() => OnClickViewDetails(@t.TodoId))">View Details</button>
                            <button type="button" class="btn btn-danger btn-sm" @onclick="()=> OpenDeleteDialog(t)">Delete</button>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
}
else
{
    @if (TodoDetailsFromTodoSearch is null)
    {
    }
    else
    {
        <SearchTodo SearchedTodo="@TodoDetailsFromTodoSearch"></SearchTodo>
    }
}

<div>
    <button class="sign-button btn btn-primary" @onclick="@OnClickGoToCreateTodo">Create new Todo</button>
</div>

@if (DeleteDialogOpen)
{
    <DeleteTodoDialog Title="Are you sure?" Text="Do you want to delete this entry?" OnClose="@OnDeleteDialogClose"></DeleteTodoDialog>
}

